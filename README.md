
# Landpay

## 概要 (Overview)

`Landpay` は、Minecraftサーバーでプレイヤーが土地を売買したり、自分の建築物を保護したりするための経済・土地管理プラグインです。
[Vault](https://www.spigotmc.org/resources/vault.34315/) と連携し、サーバー内の通貨を利用して土地の取引を行います。直感的な操作で範囲を選択し、簡単なコマンドで土地の販売、購入、保護が可能です。

データはサーバーフォルダ内のSQLiteデータベースに保存されるため、軽量で外部データベースサーバーを必要としません。

## 機能 (Features)

  * **土地の販売**: プレイヤーは指定した範囲の土地に価格を設定して販売できます。
  * **土地の購入**: 販売されている土地をサーバー内通貨で購入できます。誤操作を防ぐため、購入時にはチャットでの確認ステップがあります。
  * **土地の保護**: 売買を目的とせず、自分の建築物などを保護するための領域を作成できます。
  * **権限管理**: 所有する土地（販売中または保護中）に他のプレイヤーを信頼ユーザーとして追加し、ブロックの設置や破壊を許可できます。
  * **Wandツール**: 直感的に土地の範囲を選択するための専用ツール（デフォルトでは木の斧）を使用します。
  * **保護機能**: 他のプレイヤーが所有・販売している土地のブロックを破壊・設置できないように保護します。
  * **カスタマイズ可能なメッセージ**: `config.yml` ですべてのプレイヤー向けメッセージを自由に変更できます。

## 必須プラグイン (Dependencies)

このプラグインを動作させるには、以下のプラグインが**必須**です。

1.  **[Vault](https://www.spigotmc.org/resources/vault.34315/)**: 経済機能の前提プラグインです。
2.  **経済プラグイン**: Vaultに対応した経済プラグイン（例: EssentialsX Economy, CMIなど）が必要です。

## 使い方 (How to Use)

### 1\. 土地の範囲を選択する

まず、販売または保護したい土地の対角線となる2点を、専用のWandで選択します。

1.  コマンド `/lwand` を実行して「Land Wand」を入手します。
2.  Wandを手に持ち、1点目のブロックを**右クリック**して始点 (`Pos1`) を設定します。
3.  2点目のブロックを**左クリック**して終点 (`Pos2`) を設定します。

### 2\. 土地を販売する

範囲選択後、以下のコマンドで土地を売りに出します。

```bash
/sland <価格> <土地名>
```

  * `<価格>`: 土地の販売価格。
  * `<土地名>`: 他のプレイヤーが購入時に使用する土地の名前。

例: `/sland 1000 main_shop`

### 3\. 土地を購入する

販売中の土地は誰でも購入できます。

1.  `/landlist` コマンドで、現在販売中の土地リストと価格を確認します。
2.  購入したい土地が見つかったら、以下のコマンドを実行します。
    ```bash
    /buyland <土地名>
    ```
3.  チャット欄に購入の確認メッセージが表示されます。`yes` と入力して購入を確定してください。`no` または他の言葉を入力するとキャンセルされます。

### 4\. 土地を保護する

土地を販売せず、自分の建築物などを保護したい場合は、以下のコマンドを使用します。

1.  Wandで保護したい範囲を選択します。
2.  次のコマンドを実行します。
    ```bash
    /prland <保護名>
    ```
    これで、あなたとあなたが許可したプレイヤー以外は、その範囲のブロックを変更できなくなります。

### 5\. 土地に他のプレイヤーの建築権限を与える

自分の所有地（販売中・保護中を問わず）に、友人などの特定のプレイヤーが建築・破壊できるように設定できます。

```bash
/pland <土地名> <プレイヤー名>
```

このコマンドで、指定したプレイヤーに土地の編集権限が付与されます。

## コマンドとパーミッション (Commands & Permissions)

| コマンド | 説明 | パーミッション |
| :--- | :--- | :--- |
| `/lwand` | 土地選択用のWandを入手します。 | 全員 |
| `/sland <価格> <土地名>` | 選択した範囲の土地を販売します。 | 全員 |
| `/buyland <土地名>` | 販売中の土地を購入します。 | 全員 |
| `/prland <保護名>` | 選択した範囲の土地を保護します。 | 全員 |
| `/pland <土地名> <プレイヤー名>` | 指定した土地にプレイヤーの編集権限を追加します。 | 土地の所有者 or `landpay.admin` |
| `/dland <土地名>` | 所有する土地の販売または保護を解除します。 | 土地の所有者 or `landpay.admin` |
| `/landlist` | 販売中の土地一覧を表示します。 | 全員 |

#### 管理者向けパーミッション

  * `landpay.admin`
      * 他人の土地を削除 (`/dland`) したり、権限を編集 (`/pland`) したりできます。
      * `config.yml` で設定された保護領域の最大体積制限を無視できます。
      * 全ての保護領域でブロックの編集が可能です。

## 設定ファイル (Configuration)

プラグイン初回起動時に `plugins/Landpay/config.yml` が生成されます。

```yaml
# config.yml

# 表示されるメッセージ
messages:
  prefix: "&6[Landpay]&r "
  wand-given: "Wand を入手しました。"
  set-pos1: "始点を設定しました。 (%x%, %y%, %z%)"
  set-pos2: "終点を設定しました。 (%x%, %y%, %z%)"
  land-for-sale: "土地「%name%」を %price% で販売開しました。"
  purchase-confirm: "土地「%name%」を %price% で購入しますか？チャットで 'yes' と入力してください。"
  purchased: "土地「%name%」を購入しました！"
  land-deleted: "土地「%name%」を削除しました。"
  protect-created: "土地「%name%」を保護しました。"
  region-exists: "その名前の土地は既に存在します。"
  region-not-found: "その土地は見つかりません。"
  not-owner: "あなたはその土地の所有者ではありません。"
  block-deny: "ここは %owner% の土地「%name%」です。"
  land-listed: "- %name% (%price%円)"

# Wandとして使用するアイテムのマテリアル名
# https://hub.spigotmc.org/javadocs/spigot/org/bukkit/Material.html
wand-material: "WOODEN_AXE"

# /prland で保護できる土地の最大体積 (幅 * 高さ * 奥行)
# landpay.admin 権限を持つプレイヤーはこの制限を受けません。
max-protect-volume: 100000
```

## データベース (Database)

このプラグインは、土地の情報を保存するために `SQLite` を使用します。データベースファイルは、サーバーのプラグインフォルダ内の以下のパスに自動的に作成されます。
`plugins/Landpay/landpay.db`
